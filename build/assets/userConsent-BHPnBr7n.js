var D=Object.defineProperty;var T=(o,e,t)=>e in o?D(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var p=(o,e,t)=>(T(o,typeof e!="symbol"?e+"":e,t),t);import{s as i,S as h}from"./temp-storage.service-BD8v5Cjg.js";import{f as R}from"./imaios-global-D0pGfse-.js";import{L as w}from"./login-management-service-DTUXGn6C.js";let m="userConsent_",S="userConsent_10",I=10,C=395;const f={ACCEPTED:1,REFUSED:0},l={EXPIRED:0,ACTIVE:1};function U(o){for(var e=o.toString(),t="",n=0;n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}var a;window.ImaiosUserConsent=(a=class{constructor(){p(this,"setCookie",function(e,t,n,s,r,g){var u=new Date;u.setTime(u.getTime()),n&&(n=n*1e3*60*60*24);var c=new Date(u.getTime()+n);document.cookie=e+"="+escape(t)+(n?";expires="+c.toGMTString():"")+(s?";path="+s:"")+(r?";domain="+r:"")+(g?";secure":"")})}init(){return w.awaitConnection().then(()=>this.onInit())}onInit(){a.hasBeenInitialized||(a.hasBeenInitialized=!0,this.checkStorageExpiration(m+this.getRemoteId()).then(e=>{e===l.EXPIRED&&this.checkStorageExpiration(S).then(t=>{if(t===l.EXPIRED)$("#userConsentModal").modal({show:!0,backdrop:"static",keyboard:!1});else if(this.getRemoteId()!==void 0){let n=i.get(S);n.session_user_consent=this.currentSessionHash(),n.imUserId=this.getRemoteId(),i.add(m+this.getRemoteId(),n,this.convertExpire(C)),this.sendUserConsentData(n)}})}))}getRemoteId(){var e;if(i.get(h.IMAIOS_USER_INFORMATION)!==null){const t=(e=i.get(h.IMAIOS_USER_INFORMATION))!=null?e:null;return t!==null&&t.id!==null&&t.id!==void 0?t.id:I}}getSessionId(){var e;if(i.get(h.IMAIOS_USER_INFORMATION)!==null){const t=(e=i.get(h.IMAIOS_USER_INFORMATION))!=null?e:null;return t!==null&&t.session_id!==null&&typeof t.session_id!="undefined"?t.session_id:null}}getConsentDate(){return new Promise(e=>{var t;return window.imConsent?e((t=window.imConsent.consent_timestamp)!=null?t:null):(R(`/${imaios.getSiteAccess()}/api/user/user-consent/check`,{method:"GET"}).then(n=>n.json()).then(n=>{if(n!==null)return e(n.consent_timestamp!==null&&typeof n.consent_timestamp!="undefined"?parseInt(n.consent_timestamp):null)}),e(null))})}checkStorageExpiration(e){const t=Math.round(Date.now()/1e3);return new Promise(n=>{if(i.checkExpire(e),i.has(e))return n(l.ACTIVE);if(e!==S)this.getConsentDate().then(s=>{const r=this.convertExpire(C)/1e3-t;return s!==null&&s+r>t?(this.userConsentSave(f.ACCEPTED,!1,(s+r)*1e3),n(l.ACTIVE)):n(l.EXPIRED)});else return n(l.EXPIRED)})}extractHostname(e){let t;return e.indexOf("://")>-1?t=e.split("/")[2]:t=e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t}extractRootDomain(e){let t=this.extractHostname(e),n=t.split("."),s=n.length;return s>2&&(t=n[s-2]+"."+n[s-1],n[s-2].length===2&&n[s-1].length===2&&(t=n[s-3]+"."+t)),t}convertExpire(e){const t=new Date;return t.setTime(t.getTime()),e=e*1e3*60*60*24,t.getTime()+e}getCookie(e){const n=`; ${document.cookie}`.split(`; ${e}=`);if(n.length===2)return n.pop().split(";").shift()}convertHash(e){return window.btoa(U(window.imaios.sha256(e)))}currentSessionHash(){return this.getSessionId()?this.convertHash(this.getSessionId()):null}checkConsent(){let e=!1;const t=m+this.getRemoteId();i.checkExpire(t);const n=i.get(t);return n!==null&&n.cookie_analytics===1&&(e=!0),e}userConsentSave(e,t=!0,n=null){const s="ga-4-disable";let r=e===f.REFUSED;imaios.store(s,r);let g=e===f.REFUSED?"denied":"granted";sendToConsent(g);const u=this.extractRootDomain(window.location.href);let c,d;const _=Math.round(Date.now()/1e3);this.getRemoteId()!==I&&this.getRemoteId()!==null&&this.getRemoteId()!==void 0?(c=this.convertExpire(C),d=this.getRemoteId()):(c=this.convertExpire(1),d=I);let E={session_user_consent:this.currentSessionHash(),cookie_analytics:e,path:"/",rootDomain:u,imUserId:d};E.consent_timestamp=e!==f.REFUSED?_:null,i.add(m+d,E,n!==null?n:c),t&&this.sendUserConsentData(E)}sendUserConsentData(e){R(`/${imaios.getSiteAccess()}/api/user/user-consent`,{method:"POST",body:JSON.stringify(e)})}},p(a,"hasBeenInitialized",!1),a);const M=window.ImaiosUserConsent;export{M as U};
//# sourceMappingURL=userConsent-BHPnBr7n.js.map
